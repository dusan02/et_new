generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

/// ENUMY - SQLite nepodporuje enums, používame String

/// Základná tabuľka s dnešnými earnings (kalendár)
model EarningsTickersToday {
  reportDate        DateTime
  ticker            String
  reportTime        String?    // BMO, AMC, TNS
  epsActual         Float?
  epsEstimate       Float?
  revenueActual     BigInt?
  revenueEstimate   BigInt?
  sector            String?
  companyType       String?
  dataSource        String?
  sourcePriority    Int?
  fiscalPeriod      String?    // Q1, Q2, Q3, Q4, FY, H1, H2
  fiscalYear        Int?
  primaryExchange   String?
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt

  @@id([reportDate, ticker])
  @@index([reportDate])
  @@index([reportDate, ticker])
  @@index([ticker])
  @@index([fiscalPeriod, fiscalYear])
  @@index([epsActual])
  @@index([revenueActual])
  @@index([reportDate, ticker, fiscalPeriod, fiscalYear])
  @@index([ticker, fiscalPeriod, fiscalYear])
  @@index([reportTime])
  @@index([sector])
  @@index([dataSource])
}

/// Pohyb/market data v deň reportu
model TodayEarningsMovements {
  ticker                   String
  reportDate               DateTime
  companyName              String
  currentPrice             Float?
  previousClose            Float?
  marketCap                BigInt?
  size                     String?    // Large, Mid, Small
  marketCapDiff            Float?
  marketCapDiffBillions    Float?
  priceChangePercent       Float?
  sharesOutstanding        BigInt?
  updatedAt                DateTime? @default(now())
  companyType              String?
  primaryExchange          String?
  reportTime               String?    // BMO, AMC, TNS

  @@id([ticker, reportDate])
  @@index([reportDate])
  @@index([reportDate, ticker])
  @@index([ticker])
  @@index([size])
  @@index([priceChangePercent])
  @@index([marketCap])
  @@index([reportDate, size])
  @@index([ticker, size])
  @@index([marketCapDiff])
  @@index([companyType])
}

/// Guidance od Benzinga/Polygon Benzinga
model BenzingaGuidance {
  id                           Int         @id @default(autoincrement())
  ticker                       String
  estimatedEpsGuidance         Float?
  estimatedRevenueGuidance     BigInt?
  epsGuideVsConsensusPct       Float?
  revenueGuideVsConsensusPct   Float?
  previousMinEpsGuidance       Float?
  previousMaxEpsGuidance       Float?
  previousMinRevenueGuidance   BigInt?
  previousMaxRevenueGuidance   BigInt?
  fiscalPeriod                 String?    // Q1, Q2, Q3, Q4, FY, H1, H2
  fiscalYear                   Int?
  releaseType                  String?
  notes                        String?     // Notes/comments from Benzinga
  lastUpdated                  DateTime?   @default(now())
  createdAt                    DateTime    @default(now())

  @@unique([ticker, fiscalPeriod, fiscalYear])
  @@index([ticker])
  @@index([ticker, fiscalPeriod, fiscalYear])
  @@index([fiscalPeriod, fiscalYear])
  @@index([lastUpdated])
  @@index([releaseType])
}

/// Log odmietnutých záznamov guidance (na debug)
model GuidanceImportFailures {
  id          Int       @id @default(autoincrement())
  ticker      String
  reason      String
  payload     String    // JSON string
  createdAt   DateTime  @default(now())
}